# Robust Counterfactuals for Markov Decision Processes under Statistical and Causal Uncertainties
Counterfactual reasoning (asking *what would have happened, had a decision been different*) is a powerful tool for identifying causes of failure and explaining the behaviour of AI systems in sequential decision-making tasks. In Markov Decision Processes (MDPs), two sources of uncertainty complicate counterfactual inference: statistical uncertainty in the MDP transitions when the MDP is estimated from trajectory data, and uncertainty about the unknown causal model, as there are multiple structural causal models (SCMs) compatible with each MDP. Existing work addresses these two challenges in isolation. We address both simultaneously by introducing a framework for partial counterfactual inference in MDPs that is robust to both statistical and causal uncertainty. Our approach provides: 1) closed-form analytical bounds for the counterfactual probabilities that are valid across all SCMs entailed by a given interval MDP (IMDP); 2) a method to compute robust causes via pessimistic value iteration on the induced counterfactual IMDP. Since the latter is constructed using our analytical bounds, our approach remains efficient and scalable to realistic MDP environments. Experiments across multiple case studies demonstrate our method's robustness and practical utility for identifying minimal sets of actions that, if changed, would have led to improved outcomes. 

## Instructions
The data for the Sepsis experiment can be found [here](https://github.com/GuyLor/gumbel_max_causal_gadgets_part2/tree/main/data). Add the unzipped `diab_txr_mats-replication.pkl.zip` file to the `data/` folder.

Before running the Julia files, you must install our edited version of the `IntervalMDP.jl` package (see [here](https://github.com/Zinoex/IntervalMDP.jl) for more information about the `IntervalMDP.jl` package) provided in this repository. To do this, `cd` into the `IntervalMDP.jl` folder, and run `julia --project=. -e 'using Pkg; Pkg.instantiate(); Pkg.precompile()'`.

To replicate the experiments, you can either run the `.sh` scripts that are provided for each of the MDP environments. The `.sh` scripts are: `run_gridworld_experiment.sh` (GridWorld (p=0.9)), `run_gridworld_uncertain_experiment.sh` (GridWorld (p=0.4)), `run_sepsis_experiment.sh` (Sepsis), `run_frozen_lake_experiment.sh` (Frozen Lake) and `run_aircraft_experiment.sh`. These will run all the experiments in the paper.
